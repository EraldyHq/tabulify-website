---json
{
    "canonical": ":howto:database:query_execution",
    "description": "This howto will shows you to execute and shows the result of a SQL Query against the tpcds data",
    "name": "Execute a query"
}
---

====== Tabli - How to execute and shows the result of a SQL Query ======


===== About =====


[[docs:system:tpcds|{{ :howto:database:tpc.svg?200|}}]]

[[docs:system:tpcds|Tpcds]] offers 100 [[docs:resource:select|queries]]. We will load the  [[docs:system:tpcds|tpcds data]] and execute the [[docs:resource:select|query]] ''number 11''.


===== Steps =====

==== Query file location ====

The file containing this query is located below the [[docs:connection:tpcds_query|tpcds-query connection]].

To get the absolute path and other information, you can use the [[docs:tabli:data:info|data info]]. Example:

<unit>
<code bash>
tabli data info postgres/query_11.sql@tpcds_query
</code>
<console>
Information about the data resource (postgres/query_11.sql@tpcds_query)
attribute          value                                                                                      description
----------------   ----------------------------------------------------------------------------------------   ----------------------------------------------------------------------
character-set      UTF-8                                                                                      The character set of the file
column-name        sql                                                                                        The name of the column when the text content is returned on one column
end-of-record      ;\r, ;\r\n, ;\n, /\r, /\r\n, /\n, \rgo\r, \r\ngo\r\n, \ngo\n, \rGO\r, \r\nGO\r\n, \nGO\n   The End Of Record string sequence
parsing-mode       SQL                                                                                        How to parse the SQL files
uri                file:///home/tabulify/postgres/query_11.sql                                                The URI of the file
absolute-path      /opt/tabulify/resources/tpcds_query/postgres/query_11.sql                                  The absolute path on the data system
connection         tpcds_query                                                                                The connection name
count              1                                                                                          The number of records
data-uri           postgres/query_11.sql@tpcds_query                                                          The data uri
logical-name       query_11                                                                                   The logical name
md5                                                                                                           The Md5 hash
name               query_11.sql                                                                               The name of the data resource
parent             postgres                                                                                   The parent
path               postgres/query_11.sql                                                                      The relative path to the default connection path
sha384                                                                                                        The Sha384 hash
sha384-integrity                                                                                              The sha384 value used in the html integrity attribute
size               2819                                                                                       The number of byte
subtype            sql                                                                                        The media subType
type               text/sql                                                                                   The media type
</console>
</unit>



This query shows customers that have generated growing sales from one year to another in the ''s'' and ''w'' sales type. Below is an excerpt.

<unit>
<code bash>
tabli data print --type text postgres/query_11.sql@tpcds_query
</code>
<console height="300px" scroll="toggle">
The first 20 rows of the data resource (postgres/query_11.sql@tpcds_query):
sql
-------------
SQL_STATEMENT
</console>
</unit>

==== Loading the sales data ====

To prevent any conflict, you can execute the below command to drop all tables from the [[howto_connection_service|postgres howto connection]]
<unit>
<code bash>
tabli data drop --not-strict *@postgres
</code>
</unit>
Loading the data with the [[docs:tabli:data:transfer|transfer command]]. The ''query_11'' is a sales query, we are then loading the ''sales'' data and their [[docs:resource:dependency|dependencies]]
<unit>
<code bash>
tabli data transfer --with-dependencies *sales@tpcds @postgres
</code>
where:
  * ''*sales@tpcds'' is a [[docs:resource:data_selector|data selector]] that:
      * selects all tables that finish with the word sales (ie ''*sales'')
      * in the [[docs:system:tpcds|TPC-DS]] connection (ie ''tpcds'')
  * ''%%--with-dependencies%%'' add the dependencies of the selection.
  * ''@postgres'' defines the target connection (the [[howto_connection_service|postgres howto connection]])
<console>
Source                         Target                            Latency (ms)   Row Count   Error   Message
----------------------------   -------------------------------   ------------   ---------   -----   -------
call_center@tpcds              call_center@postgres              80             2
catalog_page@tpcds             catalog_page@postgres             485            11718
catalog_sales@tpcds            catalog_sales@postgres            13072          89807
customer@tpcds                 customer@postgres                 1301           1000
customer_address@tpcds         customer_address@postgres         64             1000
customer_demographics@tpcds    customer_demographics@postgres    28150          1920800
date_dim@tpcds                 date_dim@postgres                 4297           73049
household_demographics@tpcds   household_demographics@postgres   179            7200
income_band@tpcds              income_band@postgres              33             20
item@tpcds                     item@postgres                     307            2000
promotion@tpcds                promotion@postgres                105            3
ship_mode@tpcds                ship_mode@postgres                43             20
store@tpcds                    store@postgres                    63             2
store_sales@tpcds              store_sales@postgres              10354          120527
time_dim@tpcds                 time_dim@postgres                 1808           86400
warehouse@tpcds                warehouse@postgres                80             1
web_page@tpcds                 web_page@postgres                 236            2
web_sales@tpcds                web_sales@postgres                2775           11876
web_site@tpcds                 web_site@postgres                 353            2
</console>
</unit>
==== Executing the query ====

A [[docs:resource:select|query]] is selected via a [[docs:resource:script_selector|script selector]] where:
  * the first part is a [[docs:resource:data_selector|data selector]] that locates one or more files that contains the ''query''
  * and the second part is the [[docs:connection:connection|connection]] where the query should run.

In the below ''script selector''
<file>
(postgres/query_11.sql@tpcds_query)@postgres
</file>
  * ''postgres/query_11.sql@tpcds_query'' is a [[docs:resource:data_selector|data selector]] that select the file ''query_11.sql'' in the subdirectory ''postgres'' of the [[docs:connection:tpcds_query|tpcds-queries]] connection.
  * ''sqlite'' is the connection where the ''query'' is executed.

A ''query data uri'' can be used with all [[docs:tabli:data:start|command]].

Example with the [[docs:tabli:data:print|data print]] command.
<unit>
<code bash db_query_execute.sh>
tabli data print (postgres/query_11.sql@tpcds_query)@postgres
</code>
<console>
customer_id        customer_first_name    customer_last_name               customer_email_address
----------------   --------------------   ------------------------------   --------------------------------------------------
AAAAAAAABMDAAAAA   Jose                   Guzman                           Jose.Guzman@stJp.edu
AAAAAAAAFLAAAAAA   Joseph                 Riley                            Joseph.Riley@znxF.com
AAAAAAAAFNCAAAAA   Jennifer               Fitzpatrick                      Jennifer.Fitzpatrick@9AK6ZnfkDN7T.edu
AAAAAAAAJCAAAAAA   Maxine                 Carlson                          Maxine.Carlson@StyP5lAokmQ29QHYMLa.edu
AAAAAAAAJGBAAAAA   Bonnie                 Harrison                         Bonnie.Harrison@AKYSOPlHEYkd.com
AAAAAAAAKMDAAAAA   Alexander              White                            Alexander.White@7v2XsptkFrc50K.org
AAAAAAAAOFCAAAAA   Timothy                Grogan                           Timothy.Grogan@pn3NH2BDng.org
AAAAAAAAPCBAAAAA   Luz                    Ransom                           Luz.Ransom@fXu5MmHo2tfK.edu
AAAAAAAAPDDAAAAA   Reginald               Garcia                           Reginald.Garcia@8NKIJxQZ.org
</console>
</unit>
