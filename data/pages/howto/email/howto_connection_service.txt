---json
{
    "aliases": [
        { "path": ":docs:connection:howto:email:howto_connection_service" }
    ],
    "page_id": "taqvt7urpsvg6jvhnqf56"
}
---
====== How to start and use the HowTo SMTP server in Tabulify ? ======


===== About =====



We provide a ''smtp'':
  * [[:docs:connection:howtos|howto connection]]
  * and [[:docs:service:howtos|howto service]] (ie a Mailpit smtp server, a local server that accepts all messages)



This howto shows you how to:
  * start an [[:docs:system:smtp|SMTP server]] with the <icon name="email" />  ''smtp'' howto [[:docs:service:docker|docker service]]
  * and use the  ''smtp'' [[docs:connection:howtos|howto connection]].


===== Steps =====


==== Docker Installation ====

[[:docs:service:howtos|howto docker services]] are an easy way to start locally a database instance.

Because [[:docs:service:howtos|howto services]] are [[:docs:service:docker|docker services]], you should have [[https://docs.docker.com/engine/install/|docker installed]] on your computer.

==== Check the service ====

By default, the [[:docs:conf:vault|user configuration vault]] is created with the [[:docs:service:howtos|howto docker services]].

You can check if the ''smtp'' service is present and see its [[:docs:service:service#attributes|attributes]] with:
  * the [[:docs:tabul:service:info|tabul service info]] command
  * or the [[:docs:conf:vault|configuration vault]]
<tabs>
    <panel>
       <label>Tabul Service Info</label>
<unit>
<code bash>
tabul service info smtp
</code>
<console>
Information about the service (smtp)
Attribute     Value                                                      Description
-----------   --------------------------------------------------------   --------------------------
COMMAND                                                                  The command
ENVIRONMENT   {MP_LABEL=Tabulify HowTo Service, MP_TENANT_ID=tabulify}   The environment attributes
IMAGE         axllent/mailpit:v1.25.1                                    The image
IS_STARTED    true                                                       The status of the service
NAME          smtp                                                       The name of the service
ORIGIN        CONF                                                       The origin of the system
PORTS         1025:1025, 8025:8025                                       The ports
TYPE          docker                                                     The type of the system
VOLUMES                                                                  The volumes
</console>
</unit>
   </panel>
   <panel selected>
       <label>Tabul Yaml Vault </label>
<unit>
<code bash>
tabul data print --type text .tabul/.tabul.yml@home | yq '.services.smtp'
</code>
<console yaml>
environment:
  MP_LABEL: Tabulify HowTo Service
  MP_TENANT_ID: tabulify
image: axllent/mailpit:v1.25.1
ports:
  - 1025:1025
  - 8025:8025
type: docker
</console>
</unit>
   </panel>
</tabs>

If the service is not present move or delete your [[:docs:conf:vault|user configuration vault file]].

==== Start the smtp service ====

To start the docker service, you can use
  * the [[:docs:tabul:service:start_command|tabul service start]] command
  * or the ''docker command''

This service is based on the [[https://hub.docker.com/r/axllent/mailpit|Mailpit Docker image]].
<tabs>
    <panel selected>
       <label>Tabulify Service</label>
<unit>
<code bash>
tabul service start smtp
</code>
<console>
1 service was started
Name   Type
----   ------
smtp   docker
</console>
</unit>
   </panel>
   <panel>
       <label>Docker Bash</label>
       You can use start the local database with the following [[docs:common:bash|Bash]] command :
<code bash>
docker run \
    -e "MP_LABEL=Tabulify HowTo Service" \
    -e MP_TENANT_ID=tabulify \
    -p 1025:1025 \
    -p 8025:8025 \
    -d \
    --name smtp \
    axllent/mailpit:v1.25.1
</code>
</panel>
<panel>
   <label>Docker CMD / Powershell</label>
  * [[docs:common:shell|CMD/Powershell]]
<code cmd>
docker run ^
    -e "MP_LABEL=Tabulify HowTo Service" ^
    -e MP_TENANT_ID=tabulify ^
    -p 1025:1025 ^
    -p 8025:8025 ^
    -d ^
    --name smtp ^
    axllent/mailpit:v1.25.1
</code>
   </panel>
</tabs>

==== Check that you can ping/connect to the service with the connection ====

<unit>
<code bash>
tabul connection ping smtp
</code>
<console>
The connection (smtp) has been pinged successfully
</console>
</unit>

==== Check that you can access the local inbox ====

The local mailpit inbox is available at: http://localhost:8025


{{:howto:email:mailpit-inbox.png|}}
==== Connection Info ====

By default, the [[:docs:conf:vault|user configuration vault]] is created with the [[:docs:service:howtos|howto docker services]].

<tabs>
    <panel>
       <label>Tabul Connection Info</label>
You can check the service with the [[:docs:tabul:service:info|tabul service info]] command
<unit>
<code bash>
tabul connection info smtp
</code>
<console>
Information about the connection (smtp)
Attribute                   Value                   Description
-------------------------   ---------------------   --------------------------------------------------------------------
AUTH                        false                   Smtp server authentication required?
BCC                                                 The default blind carbon copy addresses
BCC_NAMES                                           The default blind carbon copy names
BOOLEAN_DATA_TYPE           Native                  Boolean data type used to store boolean values
CC                                                  The default carbon copy addresses if none is provided
CC_NAMES                                            The default carbon copy names to address if none is provided
COMMENT                     HowTo Smtp Connection   A connection description
DATE_DATA_TYPE              NATIVE                  Date data type used to store date values
DEBUG                       false                   Smtp Debug
FROM                                                The default from address if none is provided
FROM_NAME                                           The default name from address if none is provided
HOST                        localhost               Host Server
MAX_CONCURRENT_THREAD                               The maximum number of threads that can be created against the system
MAX_NAME_IN_PATH                                    The maximum number of names in a path
NAME                        smtp                    The name of the connection
NATIVES                                             Native Driver attributes (jdbc properties, ...)
ORIGIN                      CONF                    The origin of the connection
PASSWORD                                            The user password
PORT                        1025                    Host Port
TIMESTAMP_DATA_TYPE         NATIVE                  Timestamp data type used to store timestamp values
TIME_DATA_TYPE              NATIVE                  Time format data type to store time values
TLS                         false                   Smtp TLS communication required
TO                          support@tabulify.com    The default to address if none is provided
TO_NAMES                                            The default names to address if none is provided
URI                         smtp://localhost:1025   The uri of the connection
USER                                                The user name
VARCHAR_DEFAULT_PRECISION                           Default precision
WORKING_PATH                                        The working path (Schema for database, directory for file system)
</console>
</unit>
   </panel>
   <panel selected>
       <label>Tabul Yaml Vault </label>
You can also check the connection attributes with the [[:docs:conf:vault|configuration vault]]
<unit>
<code bash>
tabul data print --type text .tabul/.tabul.yml@home | yq '.connections.smtp'
</code>
<console yaml>
comment: HowTo Smtp Connection
uri: smtp://localhost:1025
</console>
</unit>
   </panel>
</tabs>

If the connection is not present, move or delete your [[:docs:conf:vault|user configuration vault file]]






==== Use the smtp connection ====


You can then use the ''smtp'' connection with the [[:docs:op:sendmail|sendmail operation]] via the target URI

Example:
<code yaml>
pipeline:
  - ...
  - name: "Send"
    operation: "sendmail"
    args:
      target-uri: "@smtp" # smtp is the default smtp connection and is therefore optional
</code>

Note that it's optional as ''smtp'' is the default connection name.

Full Howto Examples:
  * [[howto:email:send_resources|]]
  * [[howto:email:mailing_list|]]


==== Stop the smtp service ====

Once, you don't need the smtp service, you can stop it:
  * with the [[:docs:tabul:service:stop|tabul service stop]] command
  * or with Docker


<tabs>
    <panel selected>
       <label>Tabul Service Stop</label>
<unit>
<code bash>
tabul service stop smtp
</code>
<console>
1 service was stopped
Name   Type
----   ------
smtp   docker
</console>
</unit>
   </panel>
   <panel>
       <label>Docker</label>
You can also stop it with Docker
<code bash>
docker stop smtp
</code>

   </panel>
</tabs>










