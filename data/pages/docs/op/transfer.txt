---json
{
    "page_id": "bu892v7h08d3oihj6bn2t"
}
---
====== Data Operation - Transfer ======

===== About =====
''transfer'' is a [[op|data operation]] that executes all this [[docs:resource:resource|data resources]] operations:
  * [[copy|copy]] (Default)
  * [[download|download]], [[upload|upload, load]]
  * [[move|move]], [[rename|rename]]
  * [[insert|insert, append]]
  * [[upsert|upsert]]
  * [[update|update]]
  * [[delete|delete]]

<note important>
In general, if you need to ''move'' or ''process'' data, you will ''transfer'' it.
</note>


The ''data transfer'' action permits you to
  * [[download|download]] a [[docs:resource:table|Sql table]] into a [[docs:resource:tabular_file|file]] ([[docs:resource:csv|CSV]], [[docs:resource:excel|Excel file]], ...)
  * [[howto:csv:database_load|load a local CSV file into a relational table]]
  * [[copy|copy]] a local file to a [[docs:system:ssh|sftp server]]
  * and more






===== Usage =====

<tabs enclosed-tabs>

<panel selected>
        <label>Pipeline</label>

In a [[:docs:flow:pipeline|Pipeline]]
<code yaml>
pipeline:
# ...
  - name: "Store"
    operation: transfer
    args:
      target-uri: '${logicalName}.csv@temp'
      transfer-operation: insert
      target-operation: replace
      ...
</code>
    </panel>
    <panel>
        <label>Tabul Data Transfer Command</label>
The ''transfer'' operation is performed by the [[docs:tabul:data:transfer|tabul data transfer]] command
    </panel>
</tabs>







===== Arguments =====



^ Name ^ Default ^ Description ^
| ''target-uri'' | - | The [[docs:resource:target_data_uri|target uri]] (Mandatory) |
| ''target-operation'' | - | A [[#resource-operation|resource operation]] that will happens on the target before the transfer |
| ''source-operation'' | - | A [[#resource-operation|resource operation]] that will happens on the source after the transfer |
^ Flow Property ^^^
| [[..:flow:granularity|step-granularity]] | ''resource'' (default) or ''record'' | The operation will be done for the whole resource or record by record |
| ''output'' | ''target'' | The output \\ - ''targets'', the target resources  \\ - ''sources'', the sources resources are passed \\ - ''results'', the [[#result|results]] of the transfer step is passed |
^ [[#Cross Transfer|Cross Transfer Properties]] ^^^
| ''source-fetch-size'' | ''10000'' | The number of record from the [[docs:flow:source|source]] for one fetch (ie network message size from the source system) |
| ''buffer-size'' | 2 x ''target-worker'' x ''fetch-size'' | The maximum number of record from stored in transit between the source and the target |
| ''target-batch-size'' | ''10000'' | The number of record send to target system at once (ie network message size to the target system) |
| ''target-commit-frequency'' | <math>2^{31}</math> (Infinite) | The number of batch sends that will trigger a commit to the target system |
| ''target-worker'' | 1 | The number of thread against the target system that will send batches |
| ''with-bind-variables'' | true | If the target system is a [[docs:system:database|sql database]], SQL bind variables will be used |
| ''metrics-data-uri'' | | A [[docs:resource:data_uri|data uri]] where the [[#metrics|transfer metrics]] will be saved |
^ Transfer Properties ^^^
| ''transfer-operation'' | ''copy'' for a [[docs:system:file|file system]] \\ ''insert'' otherwise | A [[#transfer-operation|transfer operation]] (copy, insert, upsert, update, ...) |
| [[#transfer mapping method|transfer-mapping-method]] | ''position'' if the target has no structure \\ ''name'' otherwise | how the source and target columns are mapped (by ''name'', ''position'', ''map-by-name'' or ''map-by-position'') |
| ''transfer-mapping-columns'' |  | the map of source target column when the mapping method is ''map-by-name'' or ''map-by-position''|
| ''transfer-mapping-strict'' | true | if true, the transfer will fail if a source column cannot be mapped to a target column with the mapping method ''name'' or ''position'' |

==== Transfer Operation  ====

The ''transfer'' operation supports the following values for the ''transfer-operation'' argument.

^ Name ^ Source/Target with \\ Same  Structure \\ Same Data ^ Additional Constraint ^
| [[copy|copy]] | Yes | target does not exist \\ or is empty |
| [[insert|insert]] | No | - |
| [[upsert|upsert]] | No | - |
| [[update|update]] | No | - |
| [[delete|delete]] | No | - |

Alias of [[copy|copy]]:
^ Name ^ Alias ^ Local Equivalent Metadata Operation ^
|   [[move|move]] | alias of [[copy|copy]] with source drop | [[rename|rename]] |
|   [[replace|replace]] | alias of [[copy|copy]] with target drop | - |

==== Default Transfer Operation ====

The default transfer operation is [[docs:system:system|system dependent]]:
  * [[copy|copy]] is the default for a [[docs:system:file|file system]]
  * [[insert|insert]] is the default for a [[docs:system:database|database system]] (If the target does not exist, it's always by default created)

==== Transfer mapping method ====

The `transfer-mapping-method` argument defines how the source columns are mapped to the target columns.

There are 4 values:
  * ''name'', the column name of the source should match a column name of the target
    * by default, if a column of the source is not found in the target, the execution will stop
    * if you want a lose mapping without any error, you can set the `transfer-mapping-strict` attribute to `false`. The source column will then not be added to the transfer.
  * ''position'', the column position of the source will match the column position of the target
    * by default, if the number of column in the source does not match the number of column in the target, the execution will stop
    * if you want a lose mapping without any error, you can set the `transfer-strict-mapping` attribute to `false`.
  * ''map-by-name'', the argument `transfer-mapping-columns` should contains a map of column name where 
    * the keys are the source column names
    * the values are the target column names
  * ''map-by-position'', the argument `transfer-mapping-columns` should contains a map of column position where:
    * the keys are the source column positions
    * the values are the target column positions
==== Resource Operation ====

The following values may be used for the ''target-operation'' and ''source-operation'' arguments.

^ Value ^ Description ^ Operation Equivalence ^
| ''truncate'' | Truncate the resource | |
| ''drop'' | Drop the resource | On the source, [[:docs:op:move|move]] \\ On the target, [[:docs:op:replace|replace]] |

==== Result ====
If you set the ''output'' arguments to ''result'', a ''result data path'' will be returned (in place of targets) and it will contain the following columns:
  * ''source'': the [[docs:flow:source|source]] [[docs:resource:data_uri|data-uri]]
  * ''target'': the [[docs:flow:target|target]] [[docs:resource:data_uri|data-uri]]
  * ''latency'': the latency in ms
  * ''count'': the [[docs:resource:count|count]] of [[docs:resource:record|record]] transfered.
  * ''error'' and ''message'': an error and a message if any errors has occured.

==== Metrics ====

If the argument ''metrics-data-uri'' is given, a metrics data resource will be created with the following columns:
  * ''run'' - the run id
  * ''timestamp'' - the metrics timestamp
  * ''metric'' - the name of the metrics
  * ''value'' - the value of the metrics
  * ''worker'' - the name of the worker (thread)

The following metrics will be recorded:
  * ''BufferSize'': the size of the memory buffer between the source and the target
  * ''BufferMaxSize'': the maximum size of the buffer
  * ''BufferRatio'': the ratio from ''Buffer Size'' against ''Buffer MaxSize''
  * ''Commits'': the number of commits
  * ''Records'': the number of records


===== Cross Transfer =====
A transfer can happen:
  * on the same [[docs:connection:connection|connection]]
  * or between two different [[docs:connection:connection|connections]] (called also a ''cross-transfer'')

<note>
Tabulify Optimization: If two connections share the same credentials and the same system [[docs:connection:uri|URL]], the transfer will be optimized and considered local. This way, the transfer is applied only on the system metadata and it happens faster because the data is not moved.
</note>
