---json
{
    "aliases": [
        { "path": ":docs:tabul:data:compare" }
    ],
    "page_id": "vky10xrtqhc7d0te81bi4"
}
---
====== Tabul - Data Compare Command (Diff)======


===== About =====
''data diff'' is a [[docs:tabul:command|tabul command]] that supports the [[docs:op:diff|data diff operations (compare)]] against one or several [[docs:resource:resource|data resources]].


You can diff:
  * [[docs:resource:content|content data resource]]
  * the [[docs:resource:structure|structure of data resource]]

<note>
Howto : [[howto:getting_started:10_resource_comparison]]
</note>



===== Syntax =====


<unit>
<code bash>
tabul data diff -h
</code>
<console>
Tabul data diff
===============

Performs a comparison (diff) between data resources.

Prerequisites:
  * The data resources to compare should have been sorted in a ascendant order on the unique columns
  * The data resources to compare should have the same number of columns

Unique Columns:
It's highly recommended to set the `--unique-column` option.
The `unique columns` are the unique identifier for a record and drives the gathering of the record to compare.
Without unique columns, the comparison can not tell if a record is absent from one set or another.
By default, this is
  * the record id (ie row id, line id) for a data comparison
  * the column name for a data structure comparison

With the `--report-level` option, you can control the output:
  * `RESOURCE` will return a data comparison reported resource by resource (default),
  * `RECORD` will return a data comparison reported record by record (A diff),
  * `ALL` will return them both

With the `--data-source` option, you can control the compared data:
  * `CONTENT` will perform a comparison on the content of the data resource,
  * `STRUCTURE` will perform a comparison on the structure of the data resource (by attribute name)
  * `ATTRIBUTE` will perform a comparison on the attributes of the data resource (by attribute key)

Exit:
If there is a non-equality (ie a diff), the process will exist with an error status.

Data Comparison Row by Row Report:
The row by row report adds the following columns:
  * `COMP_ID`: a row id of the comparison report
  * `COMP_ORIGIN `: the origin of the record (the source, the target or both)
  * `COMP_COMMENT`: a high level comment that explains the difference
  * `COMP_DIFF_ID`: the id of a difference - not null if a difference has been seen. Two records with the same diff id have been compared
  * `COMP_ORIGIN_ID`: the record id if the comparison can not determine an unique column



Examples
--------

 1 - Data comparison between two different queries:


    tabul data diff (queryFile1.sql)@sqlite (queryFile2.sql)@sqlite


 2 - Data comparison between a query and a table on two different systems


    tabul data diff (queryFile.sql)@sqlite table@postgres




Syntax
------


    tabul data diff [options|flags] <source-selector> <target-data-uri>


where:


  Arguments:

    <source-selector>                                       A data selector that select the data resources to compare

    <target-data-uri>                                       A target data URI that defines the target to compare - if not defined, an empty target


  Options:

    -ds,--data-source <CONTENT|STRUCTURE|ATTRIBUTE>         Set the origin of data to use for the comparison

    -rl,--report-level <RESOURCE|RECORD|ALL>                Set the report level returned

    --unique-column <columnName>                            The unique column name of the data resource (Default to record id for data comparison and to `name` for a structure comparison)


  Data Definition Options:

    -sa,--source-attribute <attributeName=value>            Set a source data resource attribute

    -ta,--target-attribute <attributeName=value>            Set a target data resource attribute


  Selection Options:

    -wd,--with-dependencies                                 If set, the dependencies will be also selected


  Global Options:

    -vf,--conf <path>                                       The path to a configuration file

    -e,--env <env>                                          The name of the environment

    -h,--help                                               Print this help

    -l,--log-level <error|warning|tip|info|fine>            Set the log level

    -ns,--not-strict                                        A minor error will not stop the process.

    -odu,--output-data-uri <outputDataUri>                  defines the output data uri for the feedback data (default: console)

    -oo,--output-operation <dataOperation>                  defines the data operations (replace, truncate) on an existing output resource before transfer.

    -oop,--output-transfer-operation <transferOperation>    defines the output transfer operation (insert, update, merge, copy). Default to `copy` for a file system and `insert` for a database.

    -pp,--passphrase <passphrase>                           A passphrase (master password) to decrypt the encrypted vault values (Env: TABUL_PASSPHRASE)

    -ph,--project-home <path>                               The project home (default to the .tabul.yml file directory)

    -v,--version                                            Print version information
</console>
</unit>
